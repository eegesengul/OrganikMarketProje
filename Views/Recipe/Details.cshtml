@model OrganikMarketProje.Models.Recipe

@{
    ViewData["Title"] = "Tarif Detayı";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>@Model.Title</h2>

@if (Model.ImageData != null)
{
        <img src="data:@Model.ImageType;base64,@Convert.ToBase64String(Model.ImageData)" width="300" class="mb-3" />
}

<p><strong>Süre:</strong> @Model.DurationMinutes dakika</p>

@if (ViewBag.AverageRating > 0)
{
        <p><strong>Ortalama Puan:</strong> ⭐ @string.Format("{0:0.0}", ViewBag.AverageRating) / 5</p>
}
else
{
        <p><em>Henüz puan verilmemiş.</em></p>
}

<h3>Malzemeler:</h3>
<ul>
    @foreach (var ingredient in Model.Ingredients)
    {
            <li>
            @ingredient.Product?.Name - @ingredient.Quantity
                <form method="post" asp-controller="Cart" asp-action="AddFromRecipe" style="display:inline;">
                    <input type="hidden" name="productId" value="@ingredient.ProductId" />
                    <input type="hidden" name="quantity" value="1" />
                    <button type="submit" class="btn btn-sm btn-outline-secondary ms-2">Sepete Ekle</button>
                </form>
            </li>
    }
</ul>

<h3>Hazırlanışı:</h3>
<p>@Model.Instructions</p>

<hr />

<!-- Favorilere Ekle/Kaldır -->
@if (User.Identity.IsAuthenticated)
{
        <form method="post" asp-controller="Favorite" asp-action="ToggleRecipe">
            <input type="hidden" name="recipeId" value="@Model.Id" />
            <button type="submit" class="btn btn-outline-warning">
            @(ViewBag.IsFavorite != null && ViewBag.IsFavorite
                    ? "⭐ Favorilerden Kaldır"
                    : "⭐ Favorilere Ekle")
            </button>
        </form>
}
else
{
        <p><em>Favorilere eklemek için <a asp-controller="Account" asp-action="Login">giriş yapın</a>.</em></p>
}

<hr />

<!-- Yorumlar -->
@await Html.PartialAsync("_CommentSection", ViewBag.RecipeComments as List<OrganikMarketProje.Models.Comment>)
